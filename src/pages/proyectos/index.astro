---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from 'astro:content';

const proyectos = await getCollection('proyectos');
const tagsUnicos = Array.from(new Set(proyectos.flatMap((p: any) => p.data.tags || [])));
---

<Layout>
  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
      <!-- Encabezado -->
      <div class="text-center mb-12">
        <span class="text-primary font-semibold tracking-widest uppercase">Portafolio</span>
        <h1 class="text-4xl font-bold text-dark mt-4 mb-6">Nuestros Proyectos</h1>
        <div class="w-20 h-1 bg-primary mx-auto"></div>
      </div>

      <!-- Filtros por tags -->
      <div class="flex flex-wrap justify-center gap-3 mb-12">
        <a
          href="/proyectos"
          class="px-5 py-2 bg-primary text-white rounded-full font-medium hover:bg-primary-dark transition-colors shadow-sm"
        >
          Todos
        </a>
        {tagsUnicos.map((tag) => (
          <a
            href={`/proyectos?tag=${tag}`}
            class="px-5 py-2 bg-white text-dark rounded-full font-medium hover:bg-primary hover:text-white transition-colors shadow-sm border border-gray-200 hover:border-primary"
          >
            {tag}
          </a>
        ))}
      </div>

      <!-- Grid de proyectos -->
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {proyectos.map((proyecto: any) => (
          <article class="bg-white rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 group border border-gray-100 hover:border-primary/20">
            <!-- Imagen con efecto hover -->
            <div class="relative overflow-hidden">
              <img 
                src={proyecto.data.image} 
                alt={proyecto.data.title}
                class="w-full h-48 object-cover transition-transform duration-500 group-hover:scale-105"
              />
              <div class="absolute inset-0 bg-primary/0 group-hover:bg-primary/10 transition-all duration-300"></div>
            </div>

            <!-- Contenido -->
            <div class="p-6">
              {proyecto.data.tags?.[0] && (
                <span class="inline-block px-3 py-1 mb-3 text-xs font-semibold tracking-widest text-primary uppercase bg-primary/10 rounded-full">
                  {proyecto.data.tags[0]}
                </span>
              )}
              
              <h2 class="text-xl font-bold text-dark mb-2 group-hover:text-primary transition-colors">
                {proyecto.data.title}
              </h2>
              
              <div class="flex items-center text-gray-500 mb-4">
                {proyecto.data.client && (
                  <span class="flex items-center mr-4">
                    <i class="fas fa-building text-sm mr-1"></i>
                    {proyecto.data.client}
                  </span>
                )}
                {proyecto.data.year && (
                  <span class="flex items-center">
                    <i class="far fa-calendar-alt text-sm mr-1"></i>
                    {proyecto.data.year}
                  </span>
                )}
              </div>
              
              <a 
                href={`/proyectos/${proyecto.slug}`} 
                class="inline-flex items-center text-primary font-medium hover:text-primary-dark transition-colors"
              >
                Ver detalles
                <svg 
                  class="w-4 h-4 ml-2 transition-transform group-hover:translate-x-1" 
                  fill="none" 
                  stroke="currentColor" 
                  viewBox="0 0 24 24"
                >
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </a>
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>
</Layout>