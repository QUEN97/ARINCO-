---
const links = [
  { name: 'Inicio', href: '/' },
  { name: 'Proyectos', href: '#proyectos' },
  { name: 'Servicios', href: '#servicios' },
  { name: 'Blog', href: '#blogs' },
  { name: 'Contacto', href: '/contacto' }
];
---

<nav 
  x-data="{
        open: false,
        isSticky: false,
        navHeight: 0,
        heroHeight: 0,
        activeHover: null,
        mobileActiveHover: null,
        hoverStyles: { opacity: 0 },
        mobileHoverStyles: { opacity: 0 },
        
        init() {
          this.navHeight = this.$refs.nav.offsetHeight;
          this.heroHeight = this.$refs.hero?.offsetHeight || 0;
          
          window.addEventListener('scroll', () => {
            this.isSticky = window.scrollY > (this.heroHeight - this.navHeight);
          });
        },
        
        updateHoverPosition(index, isMobile = false) {
          const refPrefix = isMobile ? 'mobileLink' : 'link';
          const el = this.$refs[`${refPrefix}${index}`];
          if (!el) return;
          
          const rect = el.getBoundingClientRect();
          const containerRect = isMobile 
            ? this.$refs.mobileMenu.getBoundingClientRect() 
            : this.$refs.nav.getBoundingClientRect();
          
          const styles = {
            width: `${rect.width}px`,
            height: `${rect.height}px`,
            transform: `translateY(${rect.top - containerRect.top}px)`,
            opacity: 1
          };
          
          if (isMobile) {
            this.mobileHoverStyles = styles;
            this.mobileActiveHover = index;
          } else {
            this.hoverStyles = styles;
            this.activeHover = index;
          }
        },
        
        resetHover(isMobile = false) {
          if (isMobile) {
            this.mobileHoverStyles = { opacity: 0 };
            this.mobileActiveHover = null;
          } else {
            this.hoverStyles = { opacity: 0 };
            this.activeHover = null;
          }
        },

        handleNavClick(href, event) {
          if (href.startsWith('#') && window.location.pathname !== '/') {
            event.preventDefault();
            window.location.href = `/${href}`;
          }
        }
      }"
        x-ref="nav"
        :class="{
          'fixed top-0 bg-dark shadow-lg': isSticky,
          'absolute bottom-0 bg-gray-900/80': !isSticky && $refs.hero,
          'fixed top-0 bg-dark': !$refs.hero
        }"
         class="w-full left-0 right-0 backdrop-blur-sm transition-all duration-300 z-50">
        
  <div class="container mx-auto px-4">
    <div class="flex justify-between items-center py-3">
      <!-- Logo -->
      <a href="/" class="flex items-center space-x-2 text-white font-bold text-xl">
        <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center">
          <i class="fas fa-building text-white text-xl"></i>
        </div>
        <span><span class="text-primary">ARINCO</span></span>
      </a>
      
      <!-- Menú Desktop (md en adelante) -->
      <div class="hidden md:flex items-center relative">
        <!-- Elemento de fondo animado -->
        <div 
          class="absolute left-0 bg-primary/20 rounded-lg transition-all duration-300 ease-out"
          :style="hoverStyles"
          style="top: 0; will-change: transform, width, height, opacity;"
        ></div>
        
        {links.map((link, index) => (
          <a 
            x-ref="`link${index}`"
            href={link.href} 
            @click="handleNavClick(link.href, $event)"
            class="relative text-white hover:text-primary transition-colors py-2 px-4 z-10"
            aria-current={Astro.url.pathname === link.href ? 'page' : undefined}
            @mouseenter="updateHoverPosition(index)"
            @mouseleave="resetHover()"
            @focus="updateHoverPosition(index)"
            @blur="resetHover()"
          >
            {link.name}
          </a>
        ))}
      </div>
      
      <!-- Botón Mobile -->
      <button 
        @click="open = !open" 
        class="md:hidden text-white focus:outline-none"
        :aria-expanded="open"
        aria-label="Menú"
      >
        <i class="fas fa-bars text-2xl" x-show="!open"></i>
        <i class="fas fa-times text-2xl" x-show="open"></i>
      </button>
    </div>
    
    <!-- Menú Mobile -->
    <div 
      x-ref="mobileMenu"
      class="md:hidden bg-dark/95 rounded-lg shadow-xl overflow-hidden relative"
      x-show="open"
      x-transition:enter="transition ease-out duration-200"
      x-transition:enter-start="opacity-0 scale-95"
      x-transition:enter-end="opacity-100 scale-100"
      x-transition:leave="transition ease-in duration-150"
      x-transition:leave-start="opacity-100 scale-100"
      x-transition:leave-end="opacity-0 scale-95"
      @click.away="open = false"
      style="display: none"
    >
      <!-- Elemento de fondo animado para móvil -->
      <div 
        class="absolute left-0 right-0 bg-primary/20 transition-all duration-300 ease-out"
        :style="mobileHoverStyles"
        style="will-change: transform, height, opacity;"
      ></div>
      
      {links.map((link, index) => (
        <a 
          x-ref="`mobileLink${index}`"
          href={link.href} 
          class="relative block py-3 px-4 text-white hover:text-primary transition-colors z-10"
          aria-current={Astro.url.pathname === link.href ? 'page' : undefined}
          @mouseenter="updateHoverPosition(index, true)"
          @mouseleave="resetHover(true)"
          @click="open = false"
        >
          {link.name}
        </a>
      ))}
    </div>
  </div>
</nav>